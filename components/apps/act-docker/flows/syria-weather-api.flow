[workflow]
name = "Syria Weather API"
description = "REST API to fetch current weather data for Syria"
start_node = DefineGetWeatherRoute

[settings]
debug_mode = true
max_retries = 3
timeout_seconds = 600

[configuration]
agent_enabled = true
agent_name = "syria-weather-backend"
agent_version = "1.0.0"
host = "0.0.0.0"
port = 9001
debug = true
cors_enabled = true

[deployment]
port = 9001
agent_name = "syria-weather-agent"
environment = "development"

[node:DefineGetWeatherRoute]
type = aci
mode = server
operation = add_route
route_path = /api/weather
methods = ["GET"]
handler = FetchWeatherHandler

[node:FetchWeatherHandler]
type = py
code = """
import urllib.request
import json

def fetch_weather():
    # Using Open-Meteo API (free, no API key needed)
    # Coordinates for Damascus, Syria
    lat = 33.5138
    lon = 36.2765

    url = f'https://api.open-meteo.com/v1/forecast?latitude={lat}&longitude={lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,rain,weather_code,cloud_cover,wind_speed_10m,wind_direction_10m&timezone=auto'

    try:
        with urllib.request.urlopen(url) as response:
            data = json.loads(response.read().decode())

        current = data.get('current', {})

        # Map weather codes to descriptions
        weather_codes = {
            0: "Clear sky",
            1: "Mainly clear",
            2: "Partly cloudy",
            3: "Overcast",
            45: "Foggy",
            48: "Depositing rime fog",
            51: "Light drizzle",
            53: "Moderate drizzle",
            55: "Dense drizzle",
            61: "Slight rain",
            63: "Moderate rain",
            65: "Heavy rain",
            71: "Slight snow",
            73: "Moderate snow",
            75: "Heavy snow",
            80: "Slight rain showers",
            81: "Moderate rain showers",
            82: "Violent rain showers",
            95: "Thunderstorm",
            96: "Thunderstorm with slight hail",
            99: "Thunderstorm with heavy hail"
        }

        weather_code = current.get('weather_code', 0)
        weather_description = weather_codes.get(weather_code, "Unknown")

        result = {
            "location": "Damascus, Syria",
            "coordinates": {
                "latitude": lat,
                "longitude": lon
            },
            "current_weather": {
                "temperature": f"{current.get('temperature_2m', 'N/A')}°C",
                "feels_like": f"{current.get('apparent_temperature', 'N/A')}°C",
                "humidity": f"{current.get('relative_humidity_2m', 'N/A')}%",
                "wind_speed": f"{current.get('wind_speed_10m', 'N/A')} km/h",
                "wind_direction": f"{current.get('wind_direction_10m', 'N/A')}°",
                "cloud_cover": f"{current.get('cloud_cover', 'N/A')}%",
                "precipitation": f"{current.get('precipitation', 0)} mm",
                "condition": weather_description,
                "weather_code": weather_code
            },
            "timestamp": current.get('time', 'N/A'),
            "timezone": data.get('timezone', 'N/A')
        }

        return {"result": result, "status": "success"}

    except Exception as e:
        return {
            "result": None,
            "status": "error",
            "error": str(e)
        }
"""
function = fetch_weather

[edges]
DefineGetWeatherRoute = FetchWeatherHandler
